<!DOCTYPE html> 
<html> 
	<head> 
	<title>0</title> 
	<meta name="viewport" content="width=device-width, initial-scale=1"> 
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.1.1/jquery.mobile-1.1.1.min.css" />
	<script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.1.1/jquery.mobile-1.1.1.min.js"></script>
	<script src="audiolib.js"></script>
<script src="tock.js"></script>
<script>

	// Base64 encoded string loaded from an external js file as variable mySample       
	// Decode the sample
	var mySample = atob(mySample);



	var 
    	tempo = 100,
    	notesPerBeat = 4,
    	tickCounter = 1,
    	tick = 0,
    	fps = 60,
    	dev, sampler;
    
	function isNumeric(elem, helperMsg){
		var numericExpression = /^[0-9]+$/;
		if(elem.value.match(numericExpression)){
			tempo = elem.value;
			tickCounter = 1;
			return true;
		}else{
			alert(helperMsg);
			elem.focus();
			return false;
		}
	}    

	function load() 
	{
 		tempo = 0;
 		tickCounter = 0;
	}

	function stop()
	{
		tempo = 0;
	}

	function beat1()
	{
		notesPerBeat = 1;
	}

	function beat2()
	{
		notesPerBeat = 2;
	}

	function beat3()
	{
		notesPerBeat = 3;
	}

	function beat4()
	{
		notesPerBeat = 4;
	}

	function audioCallback(buffer, channelCount){
    	// Fill the buffer with the sampler output
    	sampler.append(buffer, channelCount);
	}

	window.addEventListener('load', function(){
    	// Create an instance of the AudioDevice class
    	dev = audioLib.AudioDevice(audioCallback /* callback for the buffer fills */, 2 /* channelCount */);
    	// Create an instance  of the Sampler class
    	sampler = audioLib.Sampler(dev.sampleRate);
    	// Load the sample to the sampler
    	sampler.loadWav(mySample, true);

    	// The addPreProcessing() method is called before .generate()
    	sampler.addPreProcessing(function(){
        // Make tickCounter approach 1, and trigger sample when reached
        tickCounter = tickCounter + 1 / dev.sampleRate * tempo / 60;

        if (tickCounter >= 1){
            tickCounter = 0;
            // Trigger the sample at e if first note, otherwise at a
            this.noteOn(tick ? 440 : 660);
            tick = (tick + 1) % notesPerBeat;
        }
    	});

	}, true);

	Sink.doInterval(function(){ 
    	// Get the tick we're at based on latency or zero if output hasn't been initialized yet 
    	currentTick = dev ? ~~(dev.getPlaybackTime() / dev.sampleRate / 60 * tempo) : -1;
    	document.title = (currentTick % notesPerBeat) + 1; 
	}, 1000/fps);
</script>



</head> 
	<body onload="load()"> 
	
	<div data-role="page" id="page">
	<div data-role="header">
		<h1>Guitar Practice Aid</h1>
	</div><!-- /header -->
	<div data-role="content">	

 	<img src="guitar.png" />
	
	</br><a href="#home" data-role="button" data-icon="arrow-r" data-theme="a">Start App</a>
	</div>
	</div>

	
	
	<div data-role="page" id="home">
	<div data-role="header">
		<h1>Guitar Practice Aid</h1>
	</div><!-- /header -->

	<div data-role="content">	
		<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent posuere, 
		purus a faucibus faucibus, nisi mauris aliquet diam, ut facilisis est 
		ipsum ac ligula. Cras nisi purus, pulvinar et lacinia fringilla, viverra 
		eget tortor. In a metus vitae lacus pharetra iaculis eget in massa. </p>		
		<br />		
		<ul data-role="listview" data-inset="true" data-filter="true">
			<li><a href="#page2">Metronome</a></li>
			<li><a href="#page3">Tune by Ear</a></li>
			<li><a href="#">Progress Tracker</a></li>
			<li><a href="#">Timer</a></li>
		</ul>

		<a href="#" data-role="button" data-icon="star" data-theme="a">About</a>
		<a href="#" data-role="button" data-icon="gear" data-theme="a">Settings</a>		
	</div><!-- /content -->
	</div><!-- /page -->

	<!-- Metronome -->

	<div data-role="page" id="page2">
	<div data-role="header">
		<h1>Metronome</h1>
	</div><!-- /header -->

	<div data-role="content">	
	
	<!--<p id="metronomestatus"></p>
	<script>
		Sink.doInterval(function(){ 
    	// Get the tick we're at based on latency or zero if output hasn't been initialized yet 
    	currentTick = dev ? ~~(dev.getPlaybackTime() / dev.sampleRate / 60 * tempo) : -1;
    	document.title = (currentTick % notesPerBeat) + 1; 
    	document.getElementById("metronomestatus").innerHTML=document.title;
		}, 1000/fps);
		
	</script>-->
	
	<form>
		Speed (bpm):</br><input type="range" name="slider-1" id="slider-1" value="60" min="0" max="220" />
	<input type='button' 
	onclick="isNumeric(document.getElementById('slider-1'), 'Numbers Only Please')"
	value='Play' />
	</form>
	</br>Notes per beat (default= 4): </br>
	<div class="ui-grid-c">
	<div class="ui-block-a">
	<button onclick="beat1()">1</button>
	</div>
	<div class="ui-block-b">
	<button onclick="beat2()">2</button>
	</div>
	<div class="ui-block-c">
	<button onclick="beat3()">3</button>
	</div>
	<div class="ui-block-d">
	<button onclick="beat4()">4</button>
	</div>
	</div><!-- /grid-c -->
	<button onclick="stop()">Stop</button>

		
	<a href="#home" data-role="button" data-icon="arrow-l" data-theme="a">Back</a>

	
	</div><!-- /content -->
	
	

	</div><!-- /page -->

	<!-- Tuner -->

	<div data-role="page" id="page3">

	<div data-role="header">
		<h1>Tune by Ear</h1>
	</div><!-- /header -->

	<div data-role="content">
	<p>Please select the type of tuning that you want to use for your instrument</p>
	</br>
	<ul data-role="listview" data-inset="true" data-filter="true">
		<li><a href="#standard">Standard</a></li>
		<li><a href="#">Drop D</a></li>
		<li><a href="#">Nashville</a></li>
		<li><a href="#">Ukulele Standard</a></li>
		<li><a href="#">Bass Standard</a></li>
	</ul>	
		
	<a href="#home" data-role="button" data-icon="arrow-l" data-theme="a">Back</a>

	
	</div><!-- /content -->

	</div><!-- /page -->
	
	<div data-role="page" id="standard">

	<div data-role="header">
		<h1>Standard Tuning (EADGBE)</h1>
	</div><!-- /header -->

	<div data-role="content">
	
	<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent posuere, purus
	 a faucibus faucibus, nisi mauris aliquet diam, ut facilisis est ipsum ac ligula. 
	 Cras nisi purus, pulvinar et lacinia fringilla, viverra eget tortor. In a metus 
	 vitae lacus pharetra iaculis eget in massa. </p>
	
	<audio id="player1" src="/sounds/Standard-E.mp3" loop></audio>
	<div class="ui-grid-a">
	<div class="ui-block-a">
	<button data-icon="star" data-theme="b" onclick="document.getElementById('player1').play()">Low E</a>
	</div>
	<div class="ui-block-b">
	<button onclick="document.getElementById('player1').pause()">Pause</button>
	</div>
	</div>
	
	<audio id="player2" src="/sounds/Standard-A.mp3" loop></audio>
	<div class="ui-grid-a">
	<div class="ui-block-a">
	<button data-icon="star" data-theme="b" onclick="document.getElementById('player2').play()">A</a>
	</div>
	<div class="ui-block-b">
	<button onclick="document.getElementById('player2').pause()">Pause</button>
	</div>
	</div>
	
	<audio id="player3" src="/sounds/Standard-D.mp3" loop></audio>
	<div class="ui-grid-a">
	<div class="ui-block-a">
	<button data-icon="star" data-theme="b" onclick="document.getElementById('player3').play()">D</a>
	</div>
	<div class="ui-block-b">
	<button onclick="document.getElementById('player3').pause()">Pause</button>
	</div>
	</div>
	
	<audio id="player4" src="/sounds/Standard-G.mp3" loop></audio>
	<div class="ui-grid-a">
	<div class="ui-block-a">
	<button data-icon="star" data-theme="b" onclick="document.getElementById('player4').play()">G</a>
	</div>
	<div class="ui-block-b">
	<button onclick="document.getElementById('player4').pause()">Pause</button>
	</div>
	</div>
	
	<audio id="player5" src="/sounds/Standard-B.mp3" loop></audio>
	<div class="ui-grid-a">
	<div class="ui-block-a">
	<button data-icon="star" data-theme="b" onclick="document.getElementById('player5').play()">B</a>
	</div>
	<div class="ui-block-b">
	<button onclick="document.getElementById('player5').pause()">Pause</button>
	</div>
	</div>
	
	<audio id="player6" src="/sounds/Standard-highE.mp3" loop></audio>
	<div class="ui-grid-a">
	<div class="ui-block-a">
	<button data-icon="star" data-theme="b" onclick="document.getElementById('player6').play()">High E</a>
	</div>
	<div class="ui-block-b">
	<button onclick="document.getElementById('player6').pause()">Pause</button>
	</div>
	</div><!-- /grid-b -->
	
	<br />
 	<a href="#page3" data-role="button" data-icon="arrow-l" data-theme="a">Back</a>

	
	</div><!-- /content -->

	</div><!-- /page --> 

</body>
</html>